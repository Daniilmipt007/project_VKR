\documentclass[a4paper, 12pt]{extarticle}

\input{preamble.tex}
\renewcommand{\abstractname}{Аннотация}

\title{Пространственно-временные характеристики в задаче декодирования временных рядов.}

\author{
	Дорин Даниил \\
	\texttt{dorin.dd@phystech.edu} \\
	\And
	Грабовой Андрей \\
	\texttt{grabovoy.av@phystech.edu}
}
\date{\today}

\begin{document}
\maketitle

\begin{abstract}

	Исследуются пространственно-временные характеристики в задаче декодирования временных рядов с дискретным представлением времени.
	В качестве задачи декодирования рассматривается задача классификации сигнала. 
	В работе проводится обзор методов классификации регестрируемого сигнала. 
	Предлагается метод классификации временных рядов, основанный на применении Римановой геометрии. 
	Для анализа предложенного метода проводится вычислительный эксперимент на выборке, 
	полученной при исследовании электрической активности мозга большого числа испытуемых с применением неинвазивной электроэнцефалографии. 
	Для увеличения объема выборки производится аугментация данных. 
	Проводится сравнение предложенного метода с известными методами классификации электроэнцефалограмм, полученных при регистрации колебаний электрического 
	потенциала головного мозга через покровы головы.

\end{abstract}

\keywords{ЭЭГ \and временные ряды \and Риманова геометрия \and пространственно-временные характеристики \and декодирование \and классификация}

\section{Введение}

\indent Основной целью анализа сигнала в данном исследовании является 
классификация \textit{электроэнцефалограммы} или \textit{ЭЭГ} \citep{teplan2002fundamentals, beniczky2020electroencephalography}~--- раздел электрофизиологии, 
изучающий закономерности суммарной электрической активности мозга, 
отводимой с поверхности кожи волосистой части головы, 
а также метод записи таких потенциалов. ЭЭГ~--- неинвазивный метод, то есть 
не требует проникновения внутрь организма или повреждения кожи или других тканей. 
Вместо этого, данные собираются с помощью внешних средств. 
В последнее время активно ведутся научные исследования, 
посвященные методам регисттрации активности мозга и декодированию 
информации \citep{siuly2016eeg} \textit{TODO: еще ссылок}. Основным направлением применения 
этих методов являются технологии нейрокомпьютерных интерфейсов.

\textit{TODO: ссылки} Несмотря на существование нескольких методов анализа активности мозга, таких как магнитоэнцефалография, 
функциональная магнитно-резонансная томография и позитронная эмиссионная томография, 
ЭЭГ остается ценным инструментом для мониторинга активности мозга из-за его относительно низкой стоимости и удобства для пациента.

Исследования ЭЭГ широко используются в медицинской практике для диагностики 
различных состояний мозга. Проведение классификации сигналов ЭЭГ играет важную роль в определении 
уровня болезни, выявлении эпилептических припадков, оценке состояния пациента в коме, а 
также для мониторинга глубокого сна \citep{smith2005eeg, gajic2014classification}.

Относительно новой, но быстро развивающейся областью исследований ЭЭГ являются интерфейсы мозг-компьютер (BCI). 
Технология BCI открывает новый способ взаимодействия мозга с компьютером. 
Система собирает сигналы мозга, анализирует их и преобразует сигналы в команды, которые могут быть отправлены на устройство 
вывода для выполнения определенного действия. 
Это позволяет осуществлять прямую связь между мозгом и компьютером. 
Ключевой целью исследований BCI является разработка нового канала связи, 
который позволяет людям с тяжелыми нервно-мышечными нарушениями напрямую передавать сообщения из своего мозга путем анализа умственной активности. 
Классификация моторных образов в задаче интерфейса мозг-компьютер может быть использована, например, для управления протезами или другими устройствами с 
помощью мысленных команд \citep{song2020assistive, cruz2021self, schwarz2020decoding}. 
Для этого проводится анализ и построение модели классификации электрических сигналов ЭЭГ, связанных с моторными образами. 
Такой подход позволяет людям с ограниченными возможностями управлять устройствами с использованием мысленных команд, 
компенсируя потерю или отсутствие нормальной моторной функции.

Две основные проблемы~--- это классификация и извлечение признаков из временных рядов.
Рассмотрим известные методы классификации временных рядов ЭЭГ, основанные на дискретном представлении времени.
Традиционные методы машинного обучения, такие как линейный дискриминантный анализ, метод опорных векторов, применяются для
анализа распределения признаков и поиска гиперплоскости для разделения различных классов \citep{fu2019improvement, liu2012automatic}. 
Один из успешных методов классификации предполагает одинаковые временные интервалы и фиксированную длину последовательности. 
В качестве основной модели обычно применяют классические модели, например, стандартная логистическая регрессия или метод опорных векторов.
Перед применением основной модели используется трансформация пространства признаков в терминах римановой геометрии \citep{barachant2010riemannian, barachant2011multiclass}.
Подробнее остановимся на методе трансформации признакового пространства. 
В работе \citep{barachant2011multiclass} метод называется \textbf{Tangent Space Mapping}.
Первым этапом данного алгоритма является формирование пространства центрированных признаков.

\begin{equation*}
	\bm{X}_i= \left[\bm{x}^i_1,\dots \bm{x}^i_{T}\right] = 
	\begin{bmatrix}
	x^i_{1,1} & x^i_{1,2} &  \dots  &  x^i_{1,T}\\
	\dots & \dots &  \dots  &  \dots\\
	x^i_{K,1} & x^i_{K,2} &  \dots  &  x^i_{K,T}
	\end{bmatrix}
	= \begin{bmatrix}
		ts_1\\
		\dots\\
		ts_K
		\end{bmatrix},~i = \overline{1, N}
	\end{equation*}
где $ts_j$~--- временной ряд с нулевым средним, полученный при измерении сигнала $j$-ым датчиком и последующим центрированием.
Тогда ковариационная матрица для одного измерения ЭЭГ имеет вид:
$$ \bm{R}_i = \dfrac{1}{T-1}\bm{X}_i\bm{X}_i^{\T}, ~\bm{R} \in \mathbb{R}^{K\times K},~i = \overline{1, N}$$

Известно, что пространство, состоящее из матриц ковариации, представляет собой 
Риманово многообразие \citep{barachant2010riemannian}. 
В каждой точке данного риманова многообразия имеется касательная плоскость с 
определенным скалярным произведением на ней. Общая касательная плоскость, 
предназначенная для отображения всех матриц ковариации в выборке, 
формируется в точке среднего геометрического по римановой метрике 
известных ковариационных матриц. Среднее геометрическое симметричных положительно определенных матриц \citep{moakher2005differential} имеет вид:
$$\bm{R} = \mathfrak{G}\left(\bm{R}_1,\dots,\bm{R}_N\right) = \underset{\bm{R}}{\text{argmin}}\sum_{i = 1}^N
\delta^2_R(\bm{R},~\bm{R}_i),$$
где риманова метрика определяется следующим образом (геодезическое расстояние):
$$\delta_R(\bm{R},~\bm{R}_i) = \|\log (\bm{R}^{-1}\bm{R}_i)\|_F = \sqrt{\sum_{i = 1}^{3N} \log^2\lambda_i},$$
$\lambda_i$~--- собственные значения матрицы $\bm{R}^{-1}\bm{R}_i$. В работе \citep{barachant2010riemannian}
получено, что для каждой ковариационной матрицы $\bm{R}_i$ существует проекция $\bm{\pi}_i$ на касательное пространство.
Таким образом, определено отображение:
$$\text{Exp}_{R}(\bm{\pi}_i) = \bm{R}_i = \bm{R}^{\frac{1}{2}} \exp\left(\bm{R}^{-\frac{1}{2}}\bm{\pi}_i\bm{R}^{-\frac{1}{2}}\right) \bm{R}^{\frac{1}{2}}$$
$$\log_{R}(\bm{R}_i) = \bm{\pi}_i = \bm{R}^{\frac{1}{2}} \log\left(\bm{R}^{-\frac{1}{2}}\bm{R}_i\bm{R}^{-\frac{1}{2}}\right) \bm{R}^{\frac{1}{2}}$$
После проектирования каждой ковариационной матрицы $\bm{R}$ с помощью $\log_{R}(~\cdot~)$, получаем
матрицы $\bm{\pi} \in \mathbb{R}^{K\times K}$. 
Последним этапом метода является векторизация.
Процесс векторизации каждой матрицы $\bm{\pi}$ в пространство с евклидовой метрикой~---
последовательная запись элементов верхнетреугольной матрицы от $\bm{\pi}$, 
где диагональные элементы имеют коэффициент 1, а недиагональные~--- коэффициент $\sqrt{2}$. 
Полученные вектора $\bm{x}$ имеют вид:
\begin{equation*}
	\bm{x} = \begin{bmatrix}
		\bm{\pi}_{1,1} & \sqrt{2} \bm{\pi}_{1,2} &  \dots  &  \sqrt{2}\bm{\pi}_{1,K} & \bm{\pi}_{2,2} & \dots & \bm{\pi}_{K,K}
		\end{bmatrix}^{\T},~~\bm{x} \in \mathbb{R}^{K(K+1)/2}
\end{equation*}

На практике построение ковариационных матриц и получение их образов в касательном пространстве выполняется 
при помощи библиотеки \textbf{PyRiemann} \citep{barachant2018pyriemann}.

\subsection*{Классификация временных рядов фМРТ}
\textit{Функциональная магнитно-резонансная томография} или \textit{фМРТ}
является разновидностью магнитно-резонансной томографии и основана на изменениях в токе крови,
вызванных нейронной активностью мозга \citep{Glover2011}.
Эти изменения происходят не моментально, а с некоторой задержкой,
которая называется временем гемодинамическая ответная реакция зависимости уровня кислорода в крови и составляет 4--8 с \citep{Bandettini1992}.
Она возникает из-за того, что сосудистая система достаточно долго реагирует на потребность мозга в глюкозе 
\citep{Logothetis2003}. 

Распространенной операцией в анализе фМРТ является маскирование: 
извлечение определенных вокселов из всего набора данных.
Обычно извлечение проводится на основе бинарной маски мозга. 
Маскирование можно рассматривать как отображение, 
которое принимает тензор четвертого порядка с пространственными размерами $X \times Y \times Z$ и временным измерением $T$, a 
возвращает тензор второго порядка размерности $K \times T$, где $K$~--- это количество оставшихся после маскирования вокселей.
Причинами маскировки данных могут быть, например, исключение вокселей, не связанных с мозгом 
или уменьшение размерности данных путем ограничения вашего анализа одной или несколькими областями интереса \citep{poldrack2007region}, 
которые могут быть определены либо функционально, либо анатомически.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Постановка задачи}
Исследуется задача декодирования временного ряда. Пусть имеется некоторый процесс (активность головного мозга):
$$\mathcal{V}(\tau),~\tau \in \mathbb{R}$$
Тогда данные выборки ~--- это регистрируемый сигнал, то есть реализация процесса $\mathcal{V}(\tau)$:
$$\bm{X} = \left[\bm{x}_1,\dots \bm{x}_{T}\right], \quad \bm{x}_t \in \mathbb{R}^K$$
Здесь $K$ ~--- число каналов. $T$ ~--- число измерений сигнала с частотой $\mu$ за время $\tau$:
$$T = \tau \mu$$
$$\bm{x}_{\tau \mu} \approx \mathcal{V}(\tau)$$
\subsection{Задача классификации отрезков регистрируемого сигнала}
В данной задаче имеется выборка регистрируемых отрезков сигнала, 
требуется классифицировать каждый наблюдаемый временной отрезок. 
Введем следующие обозначения:
Пусть имеется $N$ зарегистрированных реализаций некоторого процесса:
$$\bm{X} = \{\bm{X}_1,\dots, \bm{X}_N\},$$
$$\bm{X}_i = \left[\bm{x}^i_1,\dots, \bm{x}^i_{T}\right], \quad \bm{x}^i_t \in \mathbb{R}^K,$$
$$\bm{Y} = \left[y_1, \dots, y_{N}\right]^{\T}, \quad y_i \in \{1,\dots, C\},$$
Здесь $y_i$~--- целевая метка класса $i$-го зарегистрированного сигнала. $C$ ~--- число классов в задаче классификации сигнала. 

Имеется соответственно выборка $\mathcal{D} = \{y_i, \bm{X}_i\},~  i = \overline{1,N}$
Требуется построить отображение $f_\theta$, которое учитывало 
бы пространственно-временные характеристиик между временными рядами от датчиков:
$$f_\theta: \bm{X} \rightarrow \{1,\dots, C\}$$ 
\subsection{Задача классификации активности}
В данной задаче предполагается получение классификации для каждого отсчета 
времени наблюдения.
Пусть имеется некоторый процесс и зарегистрированная реализация данного 
процесса в виде дискретного числа измерений. Каждому измерению соответствует
класс активности. Формально:
$$\bm{X} = \{\bm{x}_1,\dots, \bm{x}_{T}\}, \quad \bm{x}_t \in \mathbb{R}^K,$$
$$\bm{Y} = \left[y_1, \dots, y_{T}\right]^{\T},\quad y_t \in \{1,\dots, C\},$$
Здесь $C$ ~--- число классов в задаче классификации активности. 
Выборка $\mathcal{D} = \{y_t, \bm{x}_t\}_{t=1}^T$

Для набора данных, описанного выше, требуется построить отображение $f_\theta$, которое учитывало 
бы пространственно-временные характеристиик между временными рядами сигнала:
$$f_\theta: \bm{X} \rightarrow \bm{Y}$$ 

\subsection{Задача классификации временных рядов фМРТ}
Пусть имеется $N$ многомерных временных рядов снимков фМРТ длины $T$:
\begin{equation*} 
	\bm{S} = \{\bm{S}_1,\dots, \bm{S}_{N}\},
\end{equation*}
\begin{equation*}
	\bm{S}_i = [\bm{s}_{1}^i, \ldots, \bm{s}_{T}^i], \quad
	\bm{s}_{t}^i \in \mathbb{R}^{X \times Y \times Z},
\end{equation*}
$$\bm{Y} = \left[y_1, \dots, y_{N}\right]^{\T},\quad y_i \in \{1,\dots, C\},$$
где $X, Y$ и $Z$~--- размерности воксельного изображения, 
$y_i$~--- целевая метка $i$-ой последовательности фМРТ снимков. 
$C$ ~--- число классов в задаче классификации временных рядов фМРТ. 

Имеется соответственно выборка $\mathcal{D} = \{y_i, \bm{S}_i\},~ i = \overline{1,N}$.
Требуется построить отображение $f_\theta$, которое учитывало 
бы пространственно-временные характеристиик между временными рядами фМРТ:
$$f_\theta: \bm{S} \rightarrow \{1,\dots, C\}$$  

\subsection{Задача классификации отрезков временного ряда фМРТ одного испытуемого}
С учётом индивидуальных анатомических особенностей головы и уникальной реакции на предъявляемые стимулы для каждого человека, 
требуется разработать модель классификации, которую можно настроить индивидуально под данные конкретного индивида. 
Формализуем задачу.

Предположим, что у нас имеется одно непрерывное измерение фМРТ с дискретным представлением времени для конкретного человека:
\begin{equation*}
	\bm{S} = [\bm{s}_{1}, \ldots, \bm{s}_{T}], \quad \bm{s}_{t} \in \mathbb{R}^{X \times Y \times Z},
\end{equation*}
где $X, Y$ и $Z$~--- размерности воксельного изображения, $T$~--- длина временного ряда фМРТ. 
В ходе процедуры фМРТ человеку демонстрируются стимулы различных категорий. 
Либо человек выполняет моторные или когнетивные задания различных типов. 
Для удобства дальнейшего изложения мы будем говорить в парадигме стимулов.
Пусть имеется временной ряд стимулов:
\begin{equation*}
	\bm{Q} = [{q}_{1}, \ldots, {q}_{T}], \quad {q}_{t} \in \{1,\dots, C\},
\end{equation*}
где $C$ ~--- число классов стимулов, которые демонстрируются испытуемому. 
Необходимо разделить временной ряд на отрезки фиксированной длины $\tau$ в соответствии с категориями представленных стимулов.

Пусть теперь имеется $N$ отрезков многомерного временного ряда фМРТ длины $\tau$, полученных при решении предыдущей задачи:
\begin{equation*} 
	\hat{\bm{S}} = \{\bm{S}_1,\dots, \bm{S}_{N}\},
\end{equation*}
\begin{equation*}
	\bm{S}_i = [\bm{s}_{1}^i, \ldots, \bm{s}_{\tau}^i], \quad
	\bm{s}_{t}^i \in \mathbb{R}^{X \times Y \times Z},
\end{equation*}
$$\bm{Y} = \left[y_1, \dots, y_{N}\right]^{\T},\quad y_i \in \{1,\dots, C\},$$
где $y_i$~--- целевая метка класса последовательности фМРТ снимков $\bm{S}_i$.  

Имеется соответственно выборка $\mathcal{D} = \{y_i, \bm{S}_i\},~ i = \overline{1,N}$.
Требуется построить отображение $f_\theta$, которое учитывало 
бы пространственно-временные характеристиик в задаче классификации многомерных временных рядов:
$$f_\theta: \hat{\bm{S}} \rightarrow \{1,\dots, C\}$$  

\section{Предлагаемый метод классификации временных рядов фМРТ}
\subsection{Сегментация данных фМРТ}
\textit{TODO: формализовать идею}
При работе с данными фМРТ часто возникает проблема сегментации длинной 
последовательности фМРТ снимков на отрезки меньшей длины для последующей классификации.
Данная задача акутуальна в работе, поскольку медицинских данных обычно не хватает на практике для обучения 
сложных моделей. Будем для простоты считать, что в данных имеется разметка моментов наблюдения стимулов и моментов отдыха испытуемого.
Один из подходов решения данной проблемы отбирать сегменты соотвествующие определенному классу стимулов и брать некоторую окрестность с 
моментами отдыха испытуемого. 

Далее необходимо проверить, что средняя по вокселям дисперсия привышает заданный порог. 
Данное условие означает, что во время просмотра стимулов активизировалось область мозга достаточного объема для последующего анализа и классификации.
Этот метод может быть адаптирован в зависимости от конкретных требований задачи. 
Важно отметить, что подбор порога может потребовать тестирования и анализа результатов на валидационных данных.
Возможно использование перекрытия между сегментами, чтобы учесть динамику изменений в данных и сделать классификацию более устойчивой.

\subsection{Маскирование снимков фМРТ}


\section{Вычислительный эксперимент}
\subsection{EEG Motor Movement/Imagery Dataset}
Для анализа работоспособности предложенного метода, а также проверки гипотез
проведен вычислительный эксперимент.
Для проведения исследования используется набор данных Physionet \citep{schalk2004bci2000, EEG_MI} для классификации ЭЭГ сигналов 
двигательных активностей, моторных образов. 
Записи были получены от 109 испытуемых с использованием системы BCI2000 и получены с 64 электродов в системе 10-10 \citep{seeck2017standardized} 
с частотой дискретизации 160 Гц. 
Каждый испытуемый выполнил 14 пробежек, включая две базовые пробежки, одну с открытыми глазами, а другую с закрытыми, 
каждая продолжительностью в одну минуту. После этих базовых пробежек они выполнили четыре различных задания, каждое из которых повторялось по три раза, 
причем каждое задание длилось две минуты.
 
Для проведения базового эксперимента используется подвыборка для задачи бинарной классификации состояния глаз открыты/закрыты.

\subsection*{Применение Римановой геометрии}
Используем подвыборку для классификации состояния глаз открыты/закрыты.
Рассмотрим несколько классических методов классификации. 
Метод опорных векторов~---один из наиболее популярных методов обучения, который применяется для решения задач классификации и регрессии.
Чтобы показать преимущество перехода к Риманову касательному пространству, проведем следующий эксперимент. 
Векторизуем все многомерные временные ряды и обучим на полученных векторах SVM. 
Теперь применим алгоритм векторизации Tangent Space Mapping (TSM) на многомерных временных рядах и после этого обучим SVM на векторизованных данных. 
Результаты на валидации и тесте приведены в таблице \ref{table:Riman}. 
Качество классификации после проектирования на касательное пространство гораздо лучше.

\begin{table}[h!]
	\centering
	\caption{Сравнение методов}
	\begin{tabular}{|c|c|c|}
		\hline
		& \multicolumn{2}{|c|}{accuracy}  \\ \hline 
		Метод & валидация  & тест \\ \hline \hline
		SVM    & $0.732$ & $0.697$      \\ \hline
		TSM SVM    & $0.939$ & $0.954$		\\ \hline
	\end{tabular}
	\label{table:Riman}
\end{table}



\subsection{UCI EEG Eye State}
Набор данных бинарной классификации состояния глаз получен в результате одного непрерывного измерения неинвазивного ЭЭГ с 
помощью нейроголовки Emotiv EEG с использованием 14 датчиков, на рис.\ref{fig:1} задействованные датчики
изображены красным цветом. 
\begin{figure}[h]
	\centering
	\includegraphics[width=0.75\textwidth]{64_channel_sharbrough.pdf}
	\caption{Задействованные датчики ЭЭГ при измерении сигнала}
	\label{fig:1}
\end{figure}


Продолжительность измерения в выборке составила 117 секунд. 
Состояние глаз было зафиксировано с помощью камеры во время измерения ЭЭГ и позже добавлено 
вручную в файл после анализа видеокадров. Метка <<1>> указывает на состояние с закрытыми глазами, а 
<<0>> ~--- на состояние с открытыми глазами. Все значения приведены в хронологическом порядке с 
первым измеренным значением в верхней части данных.
Основные характеристики выборки представлены в
Таблице~\ref{table:sample}.

\begin{table}
	\centering
	\caption{Описание выборки}
	\begin{tabular}{|c|c|c|}
		\hline
		Название                       & Обозначение & Значение             \\
		\hline \hline
		Продолжительность обследования & $\tau$         & 117 с                \\ \hline
		Частота измерения сигнала      & $\mu$       & 128.03 $\text{с}^{-1}$   \\ \hline
	    Число каналов (датчиков)    & $K$   & 14          \\ \hline
		Число измерений сигнала             & $T$  & 14980           \\ \hline
	\end{tabular}
	\label{table:sample}
\end{table}

\section{Заключение}


\newpage

\bibliographystyle{plain}
\bibliography{references.bib}

\end{document}
